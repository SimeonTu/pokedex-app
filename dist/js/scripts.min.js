const colorThief=new ColorThief;let pokemonList=[],missingNo="img/missingNo.png",offset,gen,end,results,searchFlag=0,finalOffset,flag=0,loadBtn=$("#btn-load-pokemon"),loadingWrapper=$(`<div class="loading-wrapper">
                            <img class="loading-gif" src="./img/pikachu-running.gif">
                          </div>`);const RGBToHSL=(e,t,o,a)=>{e/=255,t/=255,o/=255;let s=Math.max(e,t,o),n=s-Math.min(e,t,o),l=n?s===e?(t-o)/n:s===t?2+(o-e)/n:4+(e-t)/n:0,r=100*(n?s<=.5?n/(2*s-n):n/(2-(2*s-n)):0)+"%",d=100*(2*s-n)/2;return d+=parseInt(a),[60*l<0?60*l+360:60*l,r,d=d>100?"100%":d<0?"0%":d+"%"].toString()},intersectionObserver=new IntersectionObserver(async function(e){console.log(e),e[0].isIntersecting&&0==flag&&(console.log("flag within observer: "+flag),$("observer").remove(),console.log("SEEN!!"),console.log("NOT OBSERVING"),console.log("search flag within observer: "+searchFlag),1==searchFlag?loadDataFromSearch(offset,offset+16):loadData(offset+1,offset+16),setTimeout(()=>{$("#pokelist").append($("<observer></obeserver>")),intersectionObserver.observe($("observer")[0]),console.log("OBSERVING")},2200))}),delay=e=>new Promise(t=>setTimeout(t,e));function addListItem(e){flag=3;let t=$(`<div class="col col-xs-12 col-sm-6 col-md-4 col-lg-3 poke-item-col poke-item-col-${e.id}" data-bs-toggle="modal" data-bs-target="#pokeModal">
                      <div class="poke-item poke-item-${e.id}">
                        <div class="poke-thumbnail">
                          <div class="poke-thumbnail-bg">
                          </div>
                          <img class="poke-img" id="poke-img-${e.id}" src="${e.imageUrl}"/>
                        </div>
                        <div class="poke-info">
                          <p class="poke-id">#</p>
                          <p class="poke-name">${e.name}</p>
                          <div class="poke-types">
                          </div>
                        </div>
                      </div>
        </div>`);t.hide();let o=e.id<10?`#000${e.id}`:e.id>=10&&e.id<100?`#00${e.id}`:e.id>=100&&e.id<1e3?`#0${e.id}`:`#${e.id}`;t.children(".poke-item").children(".poke-info").children(".poke-id").text(o),e.types.forEach(function(o){t.children(`.poke-item-${e.id}`).children(".poke-info").children(".poke-types").append($(`<span class="pill bg-color-${o}">${o}</span>`))}),t.on("click",()=>showModal(e)),$(".poke-row").append(t)}function toggleButton(){let e=$(".gen-dropdown-menu"),t=$("#gen-dropdown-btn");e.hasClass("toggle")?(e.toggleClass("toggle"),t.css("filter","brightness(1.15)"),e.slideDown()):(e.toggleClass("toggle"),t.css("filter","none"),e.slideUp())}function checkGen(e,t,o){if(offset=o,console.log("num within checkgen is: "+t),console.log("max within chechgen is: "+o),1==e&&offset>=151)return end=1,151;if(2==e&&offset>=251)return end=1,251;if(3==e&&offset>=386)return end=1,386;if(4==e&&offset>=493)return end=1,493;if(5==e&&offset>=649)return end=1,649;else if(6==e&&offset>=721)return end=1,721;else if(7==e&&offset>=809)return end=1,809;else if(8==e&&offset>=905)return end=1,905;else if(9==e&&offset>=1017)return end=1,1017;else return o}function genButtons(e,t){$(`.gen-${e}`).on("click",()=>{"none"==loadBtn.css("display")&&loadBtn.show(),$("observer").length&&intersectionObserver.unobserve($("observer")[0]),1==end&&(end=0),$("#gen-dropdown-btn").text($(`.gen-${e}`).html()).append($("<span id='hamburger'> ☰</span>")),$("#now-showing-div span").text($(`.gen-${e}`).html()),$("input[type='text']").val(""),toggleButton(),searchFlag=0,gen=e,flag=3,$(".poke-row").empty(),loadData(t+1,t+16)})}$("#gen-dropdown-btn").on("click",toggleButton),$(window).on("click",e=>{"block"!=$(".gen-dropdown-menu").css("display")||Array.from(e.target.classList).includes("dropdown-item")||"gen-dropdown-btn"==e.target.id||"hamburger"==e.target.id||toggleButton()}),$(window).scroll(function(){$(this).scrollTop()>450?("none"==$(".modal").css("display")&&($("#now-showing-div").fadeIn(),$("#now-showing-div").css("display","flex")),$("#back-to-top").fadeIn(),$("#back-to-top").css("display","flex")):($("#now-showing-div").fadeOut(),$("#back-to-top").fadeOut())}),$("#back-to-top").click(function(){return $("body,html").animate({scrollTop:0},600,"easeOutQuad"),!1}),$(".gen-none").on("click",()=>{"none"==loadBtn.css("display")&&loadBtn.show(),$("observer").length&&intersectionObserver.unobserve($("observer")[0]),1==end&&(end=0),$("#gen-dropdown-btn").text($(".gen-none").html()).append($("<span id='hamburger'> ☰</span>")),$("#now-showing-div span").text(`All Pok\xe9mon`),$("input[type='text']").val(""),$(".poke-row").empty(),toggleButton(),searchFlag=0,flag=3,$(".poke-row").empty(),loadData(1,16)});for(let i=1;i<10;i++){let e;switch(i){case 1:e=0;break;case 2:e=151;break;case 3:e=251;break;case 4:e=386;break;case 5:e=493;break;case 6:e=649;break;case 7:e=721;break;case 8:e=809;break;case 9:e=905}genButtons(i,e)}function loadBtnFunc(){loadBtn.hide(),flag=0,0==searchFlag?loadData(offset+1,offset+16):(console.log("offset within button: "+offset),loadDataFromSearch(offset,offset+16)),$("#pokelist").append($("<observer></obeserver>")),setTimeout(()=>{intersectionObserver.observe($("observer")[0])},1800)}loadBtn.on("click",loadBtnFunc);let mediaQueryWidth=window.matchMedia("(max-width: 575px)"),mediaQueryHeight=window.matchMedia("(max-width: 575px), (max-height: 850px)");function handleTabletChangeWidth(e){e.matches?$("input[type='text']").attr("placeholder","Search"):$("input[type='text']").attr("placeholder","")}function handleTabletChangeHeight(e){e.matches?$(".modal-dialog").addClass("modal-dialog-centered"):$(".modal-dialog").removeClass("modal-dialog-centered")}function filterPokemon(e){$("#gen-dropdown-btn").html("Generation <span id='hamburger'>☰</span>"),end=0,flag=3,finalOffset=null,val=$("input[type='text']").val(),console.log(val),val?(pokemonList=[],$(".poke-row").empty(),$(".poke-row").append(loadingWrapper),loadBtn.hide(),getNames().then(e=>{if((results=e.filter(e=>e.includes(val.toLowerCase()))).length>0)console.log("yeppers"),console.log(results),$("#now-showing-div span").text(`"${val}"`),results.length>16?(loadBtn.show(),flag=3,loadDataFromSearch(0,16)):(console.log("else reached within search"),loadDataFromSearch(0,results.length));else{console.log("Whoops!"),loadingWrapper.remove(),$(".poke-row").append("<span id='no-results-msg'>No Pok\xe9mon matched your search</span><img id='no-result-img' src='img/crying.gif'>");return}})):("none"==loadBtn.css("display")&&loadBtn.show(),$(".poke-row").empty(),searchFlag=0,loadData(1,16))}async function getNames(){return fetch("pokemonNames.txt").then(e=>e.text()).then(e=>JSON.parse(e)).catch(e=>console.error(e))}function loadData(e,t){pokemonList=[],loadList(e,t).then(function(){pokemonList.forEach(function(e){addListItem(e)})}).then(()=>loadPokesAnim())}function loadDataFromSearch(e,t){pokemonList=[],searchFlag=1,loadListFromSearch(e,t).then(function(){pokemonList.forEach(function(e){addListItem(e)})}).then(()=>loadPokesAnim())}async function loadList(e,t){for(console.log(flag),(0==flag||3==flag)&&($(".poke-row").append(loadingWrapper),loadingWrapper.addClass("display")),t=offset=checkGen(gen,e,t),console.log("num within loadlist: "+e),console.log("max within loadlist: "+t);e<=t;e++){let o=`https://pokeapi.co/api/v2/pokemon/${e}`;pokemonList.push(fetch(o).then(e=>e.json()))}return Promise.all(pokemonList).then(e=>{console.log(e),pokemonList=e.map(e=>({name:e.name.charAt(0).toUpperCase()+e.name.slice(1),id:e.id,imageUrl:null==e.sprites.other["official-artwork"].front_default?missingNo:e.sprites.other["official-artwork"].front_default,types:e.types.map(e=>e.type.name)}))})}async function loadListFromSearch(e,t){for(console.log(flag),(0==flag||3==flag)&&($(".poke-row").append(loadingWrapper),loadingWrapper.addClass("display")),offset=t,finalOffset=null,console.log("num within listsearch func: "+e),console.log("offset within listsearch func: "+offset),(offset>results.length||results.length<16)&&(console.log("offset < results or results > 16\n setting flag to 1 and offset to results.length"),searchFlag=0,end=1,finalOffset=results.length%16,offset=results.length);e<offset;e++){let o=`https://pokeapi.co/api/v2/pokemon/${results[e].toLowerCase()}`;console.log(o),pokemonList.push(fetch(o).then(e=>e.json()))}return Promise.all(pokemonList).then(e=>{for(x in gen=0,e)pokemonList=e.map(e=>({name:e.name.charAt(0).toUpperCase()+e.name.slice(1),id:e.id,imageUrl:null==e.sprites.other["official-artwork"].front_default?missingNo:e.sprites.other["official-artwork"].front_default,types:e.types.map(e=>e.type.name)})),console.log(pokemonList[x].imageUrl);console.log(pokemonList)})}function loadPokesAnim(){let e=finalOffset||pokemonList.length,t=pokemonList.length<16?pokemonList.length:finalOffset||16;flag=3,console.log("counter is: "+e),console.log("flag within anim func: "+flag);for(let o=0;o<t;o++){let a=document.querySelector(`#poke-img-${pokemonList[o].id}`);if(a.crossOrigin="Anonymous",a.complete){let s=`data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" style="opacity:0.75; transform:rotate(145deg);" id="Layer_1" data-name="Layer 1" viewBox="0 0 910.13 908.95"><defs><style>.cls-1{fill:%23fff;opacity:0;}.cls-2{fill:rgb(${colorThief.getColor(a).toString()});}.cls-3{fill:rgb(${colorThief.getColor(a).toString()});}</style></defs><title>Pokeball</title><path class="cls-1" d="M337,730c.61-252,204.75-455.12,456.36-454.09,251.82,1,454.28,204.19,453.77,455.38s-204.7,454.42-455.63,453.56C539.59,1184,336.4,980.67,337,730Z" transform="translate(-337 -275.94)"/><path class="cls-2" d="M510,764.63c35.7,0,71.41.21,107.11-.17,7.31-.08,10.2,2,12,9.28,18.82,73.7,86,125.21,163,125.39A168.44,168.44,0,0,0,955.42,773.8c2-7.44,4.77-9.34,12-9.31q107.67.35,215.35,0c8,0,9.52,1.5,8.64,9.91-17.11,163.09-136.13,305.55-302.49,345.19-136.23,32.45-259,1.84-364.57-90.72-72-63.09-113.69-143.59-129.42-237.73-4.43-26.52-4.49-26.5,22.66-26.5Z" transform="translate(-337 -275.94)"/><path class="cls-3" d="M1073.7,695.83c-34.94,0-69.89-.26-104.82.19-8.34.11-11.65-2.73-13.91-10.64C935.18,616,874.39,565.77,806.24,562c-76.78-4.26-141.58,35.28-170.68,104.14-.87,2.07-1.66,4.19-2.38,6.31-8,23.38-8,23.38-33.4,23.38-64.63,0-129.25-.15-193.88.15-9.61,0-13.84-.92-12.11-12.72,22.8-155.69,106.22-266.09,251.65-325,156.73-63.54,330.1-21.39,443.93,103.13,57.07,62.43,90.45,136.3,101,220.32,1.76,14.11,1.64,14.15-12.93,14.16Q1125.56,695.84,1073.7,695.83Z" transform="translate(-337 -275.94)"/><path class="cls-2" d="M793.12,848.53c-64.13.57-118.48-51.88-119-114.84-.55-67.27,51.26-121,117.05-121.43,64.85-.41,118.47,52.27,119.29,117.21C911.3,794,858.11,848,793.12,848.53Z" transform="translate(-337 -275.94)"/><path class="cls-1" d="M793.1,672.52c32.69.37,57.55,26.21,57.15,59.39-.39,31.86-26.4,56.79-59,56.55a57.74,57.74,0,0,1-57.36-58.33C734.31,697.35,760.2,672.15,793.1,672.52Z" transform="translate(-337 -275.94)"/></svg>`;document.querySelector(`.poke-item-${pokemonList[o].id}`).style.backgroundColor=`hsl(${RGBToHSL(...colorThief.getColor(a),"+20")})`,$(`.poke-item-col-${pokemonList[o].id}`).children(".poke-item").children(".poke-thumbnail").children(".poke-thumbnail-bg").css("background-image",`url('${s}')`),console.log("img is complete:"+pokemonList[o].name),e-=1,console.log(e)}else $(`#poke-img-${pokemonList[o].id}`).on("load",()=>{let t=`data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" style="opacity:0.75; transform:rotate(145deg);" id="Layer_1" data-name="Layer 1" viewBox="0 0 910.13 908.95"><defs><style>.cls-1{fill:%23fff;opacity:0;}.cls-2{fill:rgb(${colorThief.getColor(a).toString()});}.cls-3{fill:rgb(${colorThief.getColor(a).toString()});}</style></defs><title>Pokeball</title><path class="cls-1" d="M337,730c.61-252,204.75-455.12,456.36-454.09,251.82,1,454.28,204.19,453.77,455.38s-204.7,454.42-455.63,453.56C539.59,1184,336.4,980.67,337,730Z" transform="translate(-337 -275.94)"/><path class="cls-2" d="M510,764.63c35.7,0,71.41.21,107.11-.17,7.31-.08,10.2,2,12,9.28,18.82,73.7,86,125.21,163,125.39A168.44,168.44,0,0,0,955.42,773.8c2-7.44,4.77-9.34,12-9.31q107.67.35,215.35,0c8,0,9.52,1.5,8.64,9.91-17.11,163.09-136.13,305.55-302.49,345.19-136.23,32.45-259,1.84-364.57-90.72-72-63.09-113.69-143.59-129.42-237.73-4.43-26.52-4.49-26.5,22.66-26.5Z" transform="translate(-337 -275.94)"/><path class="cls-3" d="M1073.7,695.83c-34.94,0-69.89-.26-104.82.19-8.34.11-11.65-2.73-13.91-10.64C935.18,616,874.39,565.77,806.24,562c-76.78-4.26-141.58,35.28-170.68,104.14-.87,2.07-1.66,4.19-2.38,6.31-8,23.38-8,23.38-33.4,23.38-64.63,0-129.25-.15-193.88.15-9.61,0-13.84-.92-12.11-12.72,22.8-155.69,106.22-266.09,251.65-325,156.73-63.54,330.1-21.39,443.93,103.13,57.07,62.43,90.45,136.3,101,220.32,1.76,14.11,1.64,14.15-12.93,14.16Q1125.56,695.84,1073.7,695.83Z" transform="translate(-337 -275.94)"/><path class="cls-2" d="M793.12,848.53c-64.13.57-118.48-51.88-119-114.84-.55-67.27,51.26-121,117.05-121.43,64.85-.41,118.47,52.27,119.29,117.21C911.3,794,858.11,848,793.12,848.53Z" transform="translate(-337 -275.94)"/><path class="cls-1" d="M793.1,672.52c32.69.37,57.55,26.21,57.15,59.39-.39,31.86-26.4,56.79-59,56.55a57.74,57.74,0,0,1-57.36-58.33C734.31,697.35,760.2,672.15,793.1,672.52Z" transform="translate(-337 -275.94)"/></svg>`;if(document.querySelector(`.poke-item-${pokemonList[o].id}`).style.backgroundColor=`hsl(${RGBToHSL(...colorThief.getColor(a),"+20")})`,$(`.poke-item-col-${pokemonList[o].id}`).children(".poke-item").children(".poke-thumbnail").children(".poke-thumbnail-bg").css("background-image",`url('${t}')`),console.log("waited for img:"+pokemonList[o].name),e-=1,console.log(e),0==e){if(loadingWrapper.remove(),$(".poke-item-col").first().show(100,function e(){$(this).next(".col").show(100,e)}),1==end){$("observer").length&&intersectionObserver.unobserve($("observer")[0]),$(".poke-row").append($("<p id='no-items-msg'>End of list</p>")),console.log("finished...");return}setTimeout(()=>{"block"==loadBtn.css("display")?(flag=3,console.log("setting flag to 3")):(flag=0,console.log("setting flag to 0"))},1e3)}})}}async function loadDetails(e){console.log(e);let t=$(".modal-body");return $(".modal-title").empty(),t.empty(),t.css("background","white"),t.append(loadingWrapper),loadingWrapper.addClass("display"),fetch(`https://pokeapi.co/api/v2/pokemon/${e.id}`).then(function(e){return e.json()}).then(function(t){e.id=t.id,e.imageUrl=null==t.sprites.other["official-artwork"].front_default?missingNo:t.sprites.other["official-artwork"].front_default,e.height=t.height/10,e.weight=t.weight/10,e.types=t.types.map(e=>e.type.name),e.stats=t.stats.map(function(e){return{name:e.stat.name.replace(/(^\w)|([-\s]\w)/g,e=>e.toUpperCase()),value:e.base_stat}})}).catch(function(e){console.error(e)})}function infoItem(e,t,o){let a=$('<div class="col-4 grid-item"></div'),s=$(`<p class="grid-description"> ${o} </p>`),n=$(`<p class="grid-title"> ${t} </p>`);return a.append(s),a.append(n),a}function statsItem(e){let t=$('<div class="col-12"></div>'),o;t.append($("<p class='grid-title stats'>Base stats</p>"));let a=["HP","ATK","DEF","SP.ATK","SP.DEF","SPD"],s=["red","orange","blue","lightblue","grey","green"];for(x in e.stats){o=$('<div class="stats-wrapper"></div>');let n=$(`<p class="grid-title"> ${a[x]} </p>`),l=$(`<div class="progress progress-striped active" role="progressbar" aria-label="Basic example" aria-valuenow="0" aria-valuemin="0" aria-valuemax="255">
      <div class="progress-bar progress-bar-success" style="width: 0%"></div>
    </div>`);l.attr("aria-valuenow",e.stats[x].value),e.stats[x].value/2.55<15?(l.children("div").html(`${e.stats[x].value}`),e.stats[x].value/2.55<10&&(l.children("div").css("text-align","center"),l.children("div").css("padding","0"))):576>$(window).width()&&e.stats[x].value/2.55<35?(l.children("div").css("text-align","center"),e.stats[x].value/2.55<20?(l.children("div").css("padding","0"),l.children("div").html(`${e.stats[x].value}`)):(l.children("div").css("padding","0"),l.children("div").html(`${e.stats[x].value}/255`))):l.children("div").html(`${e.stats[x].value}/255`),l.children("div").css("background-color",s[x]),o.append(n),o.append(l),t.append(o),o.children("div").children(".progress-bar").animate({width:e.stats[x].value/2.55+"%"},800,"easeOutCirc")}return t}async function showModal(e){$("#now-showing-div").fadeOut(),loadDetails(e).then(function(){console.log("loaded details...");let t=$(".modal-body");t.addClass(`modal-body-${e.id}`),t.empty();let o=$(`<div class='modal-info-image-wrapper modal-info-image-wrapper-${e.id}'></div>`),a=$(`<img id="poke-img-modal-${e.id}" src='${e.imageUrl}'/>`);o.append(a);let s=$('<div class="container text-center modal-info-stats-grid"></div>'),n=$('<div class="row d-flex justify-content-evenly"></div>');s.append(n),s.append($('<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>'));let l=e.id<10?`#000${e.id}`:e.id>=10&&e.id<100?`#00${e.id}`:e.id>=100&&e.id<1e3?`#0${e.id}`:`#${e.id}`;n.append($(`<p class="modal-poke-name">${e.name}<span class="modal-poke-id"> ${l}</span></p>`));let r=$("<div class='poke-types'></div>");e.types.forEach(function(e){r.append($(`<span class=" pill bg-color-${e}">${e}</span>`))}),n.append(r),n.append(infoItem(e,"Height",`${e.height}m`)),n.append(infoItem(e,"Weight",`${e.weight}kg`)),n.append(statsItem(e)),o.hide(),s.hide(),t.append(o),t.append(s);let d=document.querySelector(`#poke-img-modal-${e.id}`);d.crossOrigin="Anonymous",d.complete?(loadingWrapper.removeClass("display"),o.fadeIn(),s.fadeIn(),$(`.modal-body-${e.id}`).css("background",`linear-gradient(356deg, rgb(255,255,255) 30%, rgb(${colorThief.getColor(d).toString()}) 100%)`),$(".grid-description").css("color",`hsl(${RGBToHSL(...colorThief.getColor(d),"-20")})`),console.log("modal img complete: "+e.name),console.log(colorThief.getColor(d).toString())):(loadingWrapper.removeClass("display"),d.addEventListener("load",function(){o.fadeIn(),s.fadeIn(),$(`.modal-body-${e.id}`).css("background",`linear-gradient(356deg, rgb(255,255,255) 50%, rgb(${colorThief.getColor(d).toString()}) 100%)`),$(".grid-description").css("color",`hsl(${RGBToHSL(...colorThief.getColor(d),"-20")})`),console.log("waited for modal img: "+e.name),console.log(colorThief.getColor(d).toString())}))})}function pokeCursors(){let e=()=>Math.floor(Math.random()*(Math.floor(12)-Math.ceil(1))+Math.ceil(1)),t=document.getElementsByTagName("a");document.body.style=`cursor: url('img/cursors/${e()}.cur'), auto;`;for(let o=0;o<t.length;o++)t[o].style=`cursor: url('img/cursors/${e()}.cur'), auto;`}mediaQueryWidth.addEventListener("change",handleTabletChangeWidth),mediaQueryHeight.addEventListener("change",handleTabletChangeHeight),handleTabletChangeWidth(mediaQueryWidth),handleTabletChangeHeight(mediaQueryHeight),$("form").on("submit",e=>{filterPokemon(e),e.preventDefault()}),$(".modal").on("hide.bs.modal",()=>{$(this).scrollTop()>450&&$("#now-showing-div").fadeIn()}),pokeCursors(),$("input[type='text']").val(""),loadData(1,16);